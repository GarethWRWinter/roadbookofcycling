---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

import heroPortrait from '../assets/home/gareth-winter-home-1.JPG';

const posts = (await getCollection('blog'))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const featured = posts[0];
const remaining = posts.slice(1);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />

		<!--
			ACT 1 — WHO YOU ARE
			Full-viewport split: dark editorial panel left, portrait right.
			The image does the talking. Copy earns every word.
		-->
		<section class="hero" aria-label="Introduction">
			<div class="hero-panel">
				<div class="hero-panel-inner">
					<p class="hero-eyebrow label">Road cycling — stories, craft &amp; performance</p>
					<h1 class="hero-headline">
						Performance,<br />craft, and the<br />quiet obsession<br />of getting better.
					</h1>
					<p class="hero-copy">
						I write from inside the sport. Where training meets equipment,
						where small details compound, and where progress is earned — not claimed.
					</p>
					<a href="/blog" class="hero-cta">Read the writing &rarr;</a>
				</div>
			</div>

			<div class="hero-photo">
				<Image
					src={heroPortrait}
					alt="Gareth Winter"
					width={1200}
					height={1600}
					loading="eager"
					fetchpriority="high"
				/>
			</div>
		</section>

		<!--
			ACT 2 — THE WRITING
			Surface the work. Lead with the best piece, full width.
			Let the images do the seducing.
		-->
		{featured && (
			<section class="writing" aria-label="Latest writing">
				<div class="writing-inner container">
					<header class="writing-head">
						<p class="label">Writing</p>
					</header>

					<a href={`/blog/${featured.id}/`} class="feature-card">
						{featured.data.heroImage && (
							<div class="feature-img">
								<Image
									src={featured.data.heroImage}
									alt={featured.data.title}
									width={1400}
									height={900}
									loading="lazy"
								/>
							</div>
						)}
						<div class="feature-text">
							<p class="feature-date label">
								<FormattedDate date={featured.data.pubDate} />
							</p>
							<h2 class="feature-title">{featured.data.title}</h2>
							{featured.data.description && (
								<p class="feature-desc">{featured.data.description}</p>
							)}
							<span class="inline-cta">Read &rarr;</span>
						</div>
					</a>

					{remaining.length > 0 && (
						<ul class="article-grid" role="list">
							{remaining.map((post) => (
								<li>
									<a href={`/blog/${post.id}/`} class="article-card">
										{post.data.heroImage && (
											<div class="card-img">
												<Image
													src={post.data.heroImage}
													alt={post.data.title}
													width={800}
													height={533}
												/>
											</div>
										)}
										<div class="card-text">
											<p class="label card-date">
												<FormattedDate date={post.data.pubDate} />
											</p>
											<h3 class="card-title">{post.data.title}</h3>
										</div>
									</a>
								</li>
							))}
						</ul>
					)}
				</div>
			</section>
		)}

		<!--
			ACT 3 — THE CLOSER
			Dark strip. Mirrors the hero. Closes the loop.
			Simple invitation, no friction.
		-->
		<div class="closer" role="complementary">
			<div class="closer-inner container">
				<p class="closer-copy">
					Former Creative Director, Team Sky.<br />
					Cyclist. Student of marginal gains.
				</p>
				<a
					href="mailto:garethwrwinter@outlook.com"
					class="closer-cta"
					aria-label="Email Gareth Winter"
				>
					Get in touch &rarr;
				</a>
			</div>
		</div>

		<Footer />
	</body>
</html>

<style>
	/* ─── Hero ───────────────────────────────────────────────────────────────
	   Full-viewport split. Dark panel left, portrait right.
	   The most editorial moment on the site.
	──────────────────────────────────────────────────────────────────────── */
	.hero {
		display: grid;
		grid-template-columns: 44fr 56fr;
		min-height: 100svh;
	}

	/* Dark panel */
	.hero-panel {
		background: var(--ink);
		display: flex;
		align-items: flex-end;
		padding: var(--s-9) var(--s-8);
	}

	.hero-panel-inner {
		max-width: 32rem;
	}

	.hero-eyebrow {
		color: rgba(246, 243, 236, 0.45);
		margin-bottom: var(--s-6);
	}

	.hero-headline {
		font-family: var(--font-serif);
		font-size: clamp(2rem, 3vw, 3.25rem);
		font-weight: 300;
		line-height: 1.08;
		letter-spacing: -0.02em;
		color: var(--bg);
		margin: 0 0 var(--s-6);
	}

	.hero-copy {
		font-size: var(--text-lg);
		color: rgba(246, 243, 236, 0.6);
		line-height: 1.65;
		max-width: 34ch;
		margin: 0 0 var(--s-8);
	}

	.hero-cta {
		display: inline-block;
		font-family: var(--font-sans);
		font-size: var(--text-xs);
		font-weight: 600;
		letter-spacing: 0.12em;
		text-transform: uppercase;
		color: var(--bg);
		text-decoration: none;
		border-bottom: 1px solid rgba(246, 243, 236, 0.3);
		padding-bottom: 3px;
		transition: border-color 200ms ease;
	}

	.hero-cta:hover {
		border-color: rgba(246, 243, 236, 0.8);
		opacity: 1;
		text-decoration: none;
	}

	/* Portrait */
	.hero-photo {
		overflow: hidden;
		background: #2a2520;
	}

	.hero-photo img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		object-position: center top;
		display: block;
	}

	/* ─── Writing ────────────────────────────────────────────────────────────
	   Featured article: large horizontal editorial card.
	   Supporting articles: clean grid below.
	──────────────────────────────────────────────────────────────────────── */
	.writing {
		padding: var(--s-10) 0;
	}

	.writing-head {
		margin-bottom: var(--s-7);
		padding-bottom: var(--s-5);
		border-bottom: 1px solid var(--border);
	}

	/* Featured card — horizontal, cinematic */
	.feature-card {
		display: grid;
		grid-template-columns: 58fr 42fr;
		text-decoration: none;
		color: inherit;
		margin-bottom: var(--s-10);
		border: 1px solid var(--border);
	}

	.feature-img {
		overflow: hidden;
		background: var(--border);
		aspect-ratio: 3 / 2;
	}

	.feature-img img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform 800ms ease;
	}

	.feature-card:hover .feature-img img {
		transform: scale(1.03);
	}

	.feature-text {
		padding: var(--s-7);
		display: flex;
		flex-direction: column;
		justify-content: flex-end;
		border-left: 1px solid var(--border);
	}

	.feature-date {
		margin-bottom: var(--s-4);
	}

	.feature-title {
		font-family: var(--font-serif);
		font-size: clamp(1.5rem, 2.5vw, var(--text-3xl));
		font-weight: 400;
		line-height: 1.1;
		letter-spacing: -0.01em;
		margin-bottom: var(--s-4);
		transition: opacity 150ms ease;
	}

	.feature-card:hover .feature-title {
		opacity: 0.65;
	}

	.feature-desc {
		font-size: var(--text-base);
		color: var(--muted);
		line-height: 1.65;
		margin-bottom: var(--s-6);
		flex-grow: 1;
	}

	/* Inline CTA — shared */
	.inline-cta {
		font-family: var(--font-sans);
		font-size: var(--text-xs);
		font-weight: 600;
		letter-spacing: 0.1em;
		text-transform: uppercase;
		color: var(--ink);
		border-bottom: 1px solid var(--border);
		padding-bottom: 2px;
		align-self: flex-start;
	}

	.feature-card:hover .inline-cta {
		border-color: var(--ink);
	}

	/* Article grid — supporting pieces */
	.article-grid {
		list-style: none;
		margin: 0;
		padding: 0;
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
		gap: var(--s-7);
	}

	.article-card {
		display: block;
		text-decoration: none;
		color: inherit;
	}

	.card-img {
		width: 100%;
		aspect-ratio: 3 / 2;
		overflow: hidden;
		background: var(--border);
		margin-bottom: var(--s-4);
	}

	.card-img img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform 600ms ease;
	}

	.article-card:hover .card-img img {
		transform: scale(1.03);
	}

	.card-date {
		margin-bottom: var(--s-2);
	}

	.card-title {
		font-family: var(--font-serif);
		font-size: var(--text-2xl);
		font-weight: 400;
		line-height: 1.15;
		margin: 0;
		transition: opacity 150ms ease;
	}

	.article-card:hover .card-title {
		opacity: 0.65;
	}

	/* ─── Closer ─────────────────────────────────────────────────────────────
	   Dark strip. Mirrors the hero. Simple invitation.
	──────────────────────────────────────────────────────────────────────── */
	.closer {
		background: var(--ink);
		padding: var(--s-9) 0;
	}

	.closer-inner {
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: var(--s-6);
		flex-wrap: wrap;
	}

	.closer-copy {
		font-family: var(--font-serif);
		font-size: clamp(1.25rem, 2.5vw, var(--text-2xl));
		font-weight: 300;
		font-style: italic;
		color: rgba(246, 243, 236, 0.65);
		line-height: 1.4;
		margin: 0;
	}

	.closer-cta {
		font-family: var(--font-sans);
		font-size: var(--text-xs);
		font-weight: 600;
		letter-spacing: 0.12em;
		text-transform: uppercase;
		color: var(--bg);
		text-decoration: none;
		border-bottom: 1px solid rgba(246, 243, 236, 0.3);
		padding-bottom: 3px;
		white-space: nowrap;
		transition: border-color 200ms ease;
		flex-shrink: 0;
	}

	.closer-cta:hover {
		border-color: rgba(246, 243, 236, 0.8);
		opacity: 1;
		text-decoration: none;
	}

	/* ─── Responsive ─────────────────────────────────────────────────────────
	   Mobile: hero stacks vertically. Portrait on top, panel below.
	   Keep the drama, drop the grid.
	──────────────────────────────────────────────────────────────────────── */
	@media (max-width: 900px) {
		.hero {
			grid-template-columns: 1fr;
			min-height: auto;
		}

		.hero-photo {
			aspect-ratio: 4 / 5;
			order: -1;
		}

		.hero-panel {
			align-items: flex-start;
			padding: var(--s-8) var(--s-5);
		}

		.hero-panel-inner {
			max-width: 100%;
		}

		.feature-card {
			grid-template-columns: 1fr;
		}

		.feature-img {
			aspect-ratio: 16 / 9;
		}

		.feature-text {
			border-left: none;
			border-top: 1px solid var(--border);
		}

		.closer-inner {
			flex-direction: column;
			align-items: flex-start;
		}
	}

	@media (max-width: 600px) {
		.hero-panel {
			padding: var(--s-7) var(--s-4);
		}

		.article-grid {
			grid-template-columns: 1fr;
		}

		.writing {
			padding: var(--s-8) 0;
		}
	}
</style>
