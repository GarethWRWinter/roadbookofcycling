---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import YouTube from '../components/YouTube.astro';
import EmailCommentBlock from '../components/EmailCommentBlock.astro';

type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage, tags, youtubeId, youtubeTitle } = Astro.props;
---

<html lang="en">
	<head>
		<BaseHead title={`${title} — Roadbook of Cycling`} description={description} image={heroImage} />
	</head>
	<body>
		<Header />

		{heroImage && (
			<div class="post-hero">
				<Image
					src={heroImage}
					alt=""
					width={1800}
					height={900}
					loading="eager"
				/>
			</div>
		)}

		<main class="post-main container">
			<header class="post-header">
				<div class="post-meta">
					<span class="label">
						<FormattedDate date={pubDate} />
					</span>
					{tags && tags.length > 0 && (
						<span class="post-tags">
							{tags.map((tag: string) => <span class="tag">{tag}</span>)}
						</span>
					)}
				</div>
				<h1 class="post-title">{title}</h1>
				{updatedDate && (
					<p class="post-updated">
						Updated <FormattedDate date={updatedDate} />
					</p>
				)}
			</header>

			<article class="prose">
				{youtubeId && <YouTube id={youtubeId} title={youtubeTitle ?? title} />}
				<p class="rb-disclosure"><slot name="disclosure" /></p>
				<slot />
			</article>

			<div class="post-contact">
				<EmailCommentBlock
					action="https://formspree.io/f/xdalabzw"
					title={title}
					url={Astro.url.toString()}
				/>
			</div>
		</main>

		<Footer />
	</body>
</html>

<style>
	/* Hero — full bleed, cinematic */
	.post-hero {
		width: 100%;
		max-height: 72vh;
		overflow: hidden;
		background: var(--ink);
	}

	.post-hero :global(img) {
		width: 100%;
		height: 72vh;
		max-height: 72vh;
		object-fit: cover;
		display: block;
		border: none;
	}

	/* Post main */
	.post-main {
		padding-top: var(--s-8);
		padding-bottom: var(--s-10);
	}

	/* Post header */
	.post-header {
		max-width: var(--measure);
		margin: 0 auto var(--s-8);
	}

	.post-meta {
		display: flex;
		align-items: center;
		gap: var(--s-4);
		margin-bottom: var(--s-5);
		flex-wrap: wrap;
	}

	.post-tags {
		display: flex;
		gap: var(--s-2);
		flex-wrap: wrap;
	}

	.tag {
		font-size: var(--text-xs);
		font-weight: 600;
		letter-spacing: 0.1em;
		text-transform: uppercase;
		color: var(--muted);
		border: 1px solid var(--border);
		padding: 0.2em 0.7em;
	}

	.post-title {
		font-family: var(--font-serif);
		font-size: clamp(2.25rem, 5vw, 3.75rem);
		font-weight: 400;
		line-height: 1.08;
		letter-spacing: -0.02em;
		margin-bottom: var(--s-4);
	}

	.post-updated {
		font-size: var(--text-sm);
		color: var(--muted);
		letter-spacing: 0.04em;
		margin: 0;
	}

	.rb-disclosure:empty { display: none; }
	.rb-disclosure {
		font-size: var(--text-sm);
		color: var(--muted);
		margin-bottom: var(--s-5);
	}

	.post-contact {
		max-width: var(--measure);
		margin: var(--s-9) auto 0;
	}
</style>
